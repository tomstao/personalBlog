---
/**
 * TwinkleStars.astro
 * This component creates twinkling stars that are appended to the galaxy on interval.
 * Twinkle stars are removed from the document after the animation is completed.
 * The svg below is just a template for the script to clone and append to the galaxy.
 */
---

<svg
  id="twinkle-star"
  class="template"
  width="149"
  height="149"
  viewBox="0 0 149 149"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  class="absolute left-full animate-twinkle"
>
  <circle cx="74" cy="74" r="11" fill="white"></circle>
  <rect
    y="141.421"
    width="200"
    height="10"
    transform="rotate(-45 0 141.421)"
    fill="url(#paint0_linear_4_2)"></rect>
  <rect
    x="7.07107"
    width="200"
    height="10"
    transform="rotate(45 7.07107 0)"
    fill="url(#paint1_linear_4_2)"></rect>
  <defs>
    <linearGradient
      id="paint0_linear_4_2"
      x1="0"
      y1="146.421"
      x2="200"
      y2="146.421"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#1E1E1E"></stop>
      <stop offset="0.445" stop-color="white"></stop>
      <stop offset="0.58721" stop-color="white"></stop>
      <stop offset="1" stop-color="#1E1E1E"></stop>
    </linearGradient>
    <linearGradient
      id="paint1_linear_4_2"
      x1="7.07107"
      y1="5"
      x2="207.071"
      y2="5"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#1E1E1E"></stop>
      <stop offset="0.42" stop-color="white"></stop>
      <stop offset="0.555" stop-color="white"></stop>
      <stop offset="1" stop-color="#1E1E1E"></stop>
    </linearGradient>
  </defs>
</svg>

<script is:inline>
  // Generate a twinkle star and append it to the galaxy, remove it after animation.
  function generateTwinkleStar() {
    const twinkleStarTemplate = document.getElementById("twinkle-star")
    if (!twinkleStarTemplate) {
      return
    }
    // Clone the twinkle star template and set its attributes.
    const twinkleStar = twinkleStarTemplate.cloneNode(true)
    twinkleStar.style.position = "absolute"
    twinkleStar.style.left = Math.floor(Math.random() * window.innerWidth) + "px"
    twinkleStar.style.top = Math.floor(Math.random() * (window.innerHeight / 3)) + "px"
    twinkleStar.style.width =
      window.innerWidth < 768
        ? Math.floor(Math.random() * (15 - 7.5 + 1) + 7.5)
        : Math.floor(Math.random() * (30 - 15 + 1) + 15) + "px"
    twinkleStar.style.height = twinkleStar.style.width

    // Add random color variations with glow
    const colors = [
      {
        fill: "#ffffff",
        glow: "drop-shadow(0 0 8px white) drop-shadow(0 0 12px rgba(255, 255, 255, 0.7))",
      },
      {
        fill: "#ef4444",
        glow: "drop-shadow(0 0 8px #ef4444) drop-shadow(0 0 12px rgba(239, 68, 68, 0.7))",
      },
      {
        fill: "#f97316",
        glow: "drop-shadow(0 0 8px #f97316) drop-shadow(0 0 12px rgba(249, 115, 22, 0.7))",
      },
      {
        fill: "#fbbf24",
        glow: "drop-shadow(0 0 8px #fbbf24) drop-shadow(0 0 12px rgba(251, 191, 36, 0.7))",
      },
      {
        fill: "#22c55e",
        glow: "drop-shadow(0 0 8px #22c55e) drop-shadow(0 0 12px rgba(34, 197, 94, 0.7))",
      },
      {
        fill: "#10b981",
        glow: "drop-shadow(0 0 8px #10b981) drop-shadow(0 0 12px rgba(16, 185, 129, 0.7))",
      },
      {
        fill: "#3b82f6",
        glow: "drop-shadow(0 0 8px #3b82f6) drop-shadow(0 0 12px rgba(59, 130, 246, 0.7))",
      },
      {
        fill: "#a855f7",
        glow: "drop-shadow(0 0 8px #a855f7) drop-shadow(0 0 12px rgba(168, 85, 247, 0.7))",
      },
    ]
    const randomColor = colors[Math.floor(Math.random() * colors.length)]

    // Apply color to the star's fill elements
    const circles = twinkleStar.querySelectorAll("circle")
    circles.forEach((circle) => circle.setAttribute("fill", randomColor.fill))

    // Apply glow effect
    twinkleStar.style.filter = randomColor.glow

    twinkleStar.classList.add("twinkle")
    document.getElementById("galaxy").appendChild(twinkleStar)

    // Remove the twinkle star after the animation is completed.
    setTimeout(() => {
      twinkleStar.remove()
    }, 2500)
  }

  setInterval(generateTwinkleStar, 5000)
</script>
