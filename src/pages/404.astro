---
import { getCollection } from "astro:content"
import PageLayout from "@layouts/PageLayout.astro"
import ArrowCard from "@components/ArrowCard"

// Get recent posts for suggestions
const recentPosts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3)
---

<PageLayout title="Page Not Found" description="The page you're looking for doesn't exist.">
  <div class="flex min-h-[60vh] flex-col items-center justify-center px-4 py-16">
    <div class="text-center">
      <!-- 404 Icon -->
      <div class="mb-6 text-8xl font-bold text-black/10 dark:text-white/10">404</div>

      <!-- Message -->
      <h1 class="mb-4 text-3xl font-bold text-black dark:text-white">Page Not Found</h1>
      <p class="mb-8 max-w-md text-black/60 dark:text-white/60">
        Sorry, the page you're looking for doesn't exist or has been moved. Try searching for what
        you need or check out the suggestions below.
      </p>

      <!-- Action Buttons -->
      <div class="mb-12 flex flex-wrap items-center justify-center gap-4">
        <a
          href="/"
          class="inline-flex items-center gap-2 rounded-lg bg-black px-5 py-2.5 font-medium text-white transition-colors hover:bg-black/80 dark:bg-white dark:text-black dark:hover:bg-white/80"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
            ></path>
          </svg>
          Go Home
        </a>
        <button
          id="search-404-btn"
          class="inline-flex items-center gap-2 rounded-lg border border-black/15 px-5 py-2.5 font-medium text-black transition-colors hover:bg-black/5 dark:border-white/20 dark:text-white dark:hover:bg-white/10"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          Search
        </button>
      </div>
    </div>

    <!-- Recent Posts Suggestions -->
    {
      recentPosts.length > 0 && (
        <div class="w-full max-w-2xl">
          <div class="mb-4 text-center text-sm font-semibold uppercase text-black dark:text-white">
            Recent Posts You Might Like
          </div>
          <ul class="flex flex-col gap-3">
            {recentPosts.map((post) => (
              <li>
                <ArrowCard entry={post} />
              </li>
            ))}
          </ul>
        </div>
      )
    }
  </div>
</PageLayout>

<script>
  function initSearch404() {
    const searchBtn = document.getElementById("search-404-btn")
    if (!searchBtn) return

    searchBtn.addEventListener("click", () => {
      // Trigger the search modal by dispatching a keyboard event
      // The search modal listens for Cmd/Ctrl+K
      const event = new KeyboardEvent("keydown", {
        key: "k",
        code: "KeyK",
        metaKey: true,
        ctrlKey: true,
        bubbles: true,
      })
      document.dispatchEvent(event)
    })
  }

  initSearch404()
  document.addEventListener("astro:after-swap", initSearch404)
</script>
